\begin{tikzpicture}[
        node distance=3.2cm, % Distanță compactă
        % --- DEFINIȚII DE STIL (Aici e magia design-ului) ---
        % 1. Actorii (Client/Server): Gradient Albastru + Umbră
        entity/.style={
                draw=blue!40!black,
                top color=white,
                bottom color=blue!10,
                rounded corners=3pt,
                align=center,
                minimum height=1cm,
                minimum width=1.8cm,
                drop shadow,
                font=\bfseries\small
            },
        % 2. Mesajele de pe săgeți
        msg/.style={
                midway,
                above,
                font=\scriptsize,
                color=black!80
            },
        % 3. Notele Interne (Chenarul cerut): Galben pal + Border Portocaliu
        process/.style={
                draw=orange!50!black,
                fill=orange!5,
                rounded corners=2pt,
                align=left,
                font=\tiny\sffamily, % Font sans-serif pentru cod/tehnic
                inner sep=4pt,
                drop shadow={opacity=0.3}
            },
        % 4. Formulele Matematice de sub săgeți
        mathnote/.style={
                below=0.1cm,
                font=\tiny,
                color=black!70
            }
    ]

    % 1. Actorii
    \node[entity] (client) {Client ($C$)};
    \node[entity, right=of client] (tgs) {TGS Server};

    % 2. Liniile vieții
    \draw[thick, gray!50] (client) -- ++(0,-5.5) coordinate (c_end);
    \draw[thick, gray!50] (tgs) -- ++(0,-5.5) coordinate (tgs_end);

    % 3. Mesajul 3 (Cerere)
    \draw[-{Stealth[length=3mm]}, thick, color=blue!40!black]
    ($(client)+(0,-1.1)$) --
    node[msg] {3. Cerere: $S, TGT, Auth_C$}
    ($(tgs)+(0,-1.1)$);

    % Formula Auth
    \node[mathnote] at ($(client)!0.5!(tgs) + (0,-1)$) {
    $Auth_C = \{C, TS\}_{K_{Sess}}$
    };

    % --- CHENARUL CERUT (Procesare Internă) ---
    % Folosim stilul 'process' definit mai sus
    \node[process, below=0.5cm of tgs, anchor=north] {
        $\bullet$ Decr. TGT ($K_{TGS}$)\\
        $\bullet$ Verif. Auth ($K_{Sess}$)\\
        $\bullet$ Gen. $K_{C,S}$ \& $T_{Serv}$
    };

    % 4. Mesajul 4 (Răspuns)
    \draw[-{Stealth[length=3mm]}, thick, color=blue!40!black]
    ($(tgs)+(0,-4)$) --
    node[msg, align=center] {4. Răspuns: $\{K_{C,S}, S\}_{K_{Sess}}$ \\ $+ T_{Serv}$}
    ($(client)+(0,-4)$);

    % Formula T_Serv
    \node[mathnote] at ($(client)!0.5!(tgs) + (0,-4)$) {
    $T_{Serv} = \{C, K_{C,S}, Life\}_{K_S}$
    };

\end{tikzpicture}
